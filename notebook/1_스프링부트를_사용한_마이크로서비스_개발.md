## 01 마이크로서비스 소개:

##### 1장의 개요

- 저자의 마이크로서비스 경험
- 마이크로서비스기반 아키텍처 소개
- 마이크로서비스의 문제
- 무넺 해결을 위한 디자인 패턴
- 문제 해결을 돕는 소프트웨어



#### 저자의 마이크로 서비스 경험:

##### 독립 소프트웨어 컴포넌트의 장정

- 플랫폼의 일부 컴포넌트트만을 자체 시스템 환경에 배포가능
- 플랫폼의 일부 컴포넌트를 고객의 시스템 환경에 있는 기존 구현으로 대체하는것이 가능
- 각 개별 컴포넌트 단위로 배포, 업그레이드 가능
- 각 컴포넌트 단위로 스케일링이 가능

##### 독립 소프트웨어 컴포넌트의 문제

- 컴포넌트 인스턴스 추가시 수동으로 설정해야 하는 번거로움과, 설정시간 이 오래걸리고 그 과정에서 오류가 생기기 쉬움
- 하나의 컴포넌트에 장애 발생시 연쇄적으로 장애를 일으키는 현상 발생( chain of failure )
- 플랫폼을 구성하는 모든 인스턴스의 구성을 일관성 있게 최신상태로 유지하는것의 어려움
- 하드웨어 사용향 측면에서 풀랫폼 상태를 모니터링하는 작업의 복잡함.
- 분산환경에서 로그 수집과 로그 이벤트를 연관시키는데 과정의 불편함.

##### 마이크로서비스 도입배경

- 일체형 어플리케이션을 개발해 비즈니즈 관점의 성공
- 고도화, 기능개발로 인한 어플리케이션의 사이즈가 비대해짐
- 시간이 지남에 따라 일체형 어플리케이션을 유지보수하고 개선하는게 힘들어짐
- 최고 샤양의 머신이 가진 성능을 넘은 스케일링을 해야 하는 어려움 발생 -> 수직 스케일링의 한계
- 수직스케일링 대신 일체형 어플리케이션을 작은 컴포넌트 방싁으로 나누는 방식으로 전환
- 오늘날의 마이크로서비스



#### 마이크로서비스의 정의:

- 빠르게 개발해 지속적으로 배포할수 있어야 한다.
- 수동 혹은 자동으로 쉽게 스케일링 할 수 있어야 한다.
- **독립적인** 업그레이드 및 스케일링이 가능한 컴포넌트

##### 독립적인 컴포넌트로 동작하려면

- 컴포넌트간에 데이터베이스의 데이터를 공유하지 않는다
- 명확한 인터페이스(API)를 통해서만 통신
- 개별적인 런타임 프로세스로 배포
- 마이크로서비스 인스턴스는 상태가 없다.



#### 마이크로서비스의 문제:

- 동시식 통신을 사용하는 다수의 개별 컴포넌트는 연쇄장애(chain of failure)를 일으 킬 수 있다.
- 다수의 소형 컴포넌트를 최산 상태로 유지하는건 어렵다
- 많은 컴포넌트가 처리에 관려하는 요청은 추적하기 어려움.
- 각 컴포넌트 수준의 하느웨서 자원 사용량 분석도 어렵다
- 다수의 소형 컴포넌트를 구성하고 관리하는데 비용이 많이들고 오류가 발생하기 쉬워짐



#### 마이크로서비스 디자인 패턴:

- 서비스 검색 패턴

  - 문제점 : 클라이언트가 마이크로서비스와 그 인스턴스를 찾을 수 있어야한다
  - 해결책 : 현재 사용가능한 마이크로 서비스와 그 인스턴스를 추적하는 컴포넌트를 추가한다

- 에지서버

  - 문제점 : 마이크로서비스 시스템의 일부만 외부에 공개하고 나머지는 숨기도록 해야한다.
  - 해결책 :  모든요청이 거치는 시스템 환경에 개 컴포넌트를 추가

- 리액티브 마이크로서비스

  - 문제점 : 블로킹 I/O 모델을 사용하여 요청 지연이나 오류가 다른 컴포넌트로 전이됨
  - 해결책 : 논블로킹I/O 사용

- 구성 중앙화

  - 문제점 : 구성정보를 한눈에 보려면?, 모든 컴포넌트가 올바르게 업데이트 되게 하려면?
  - 해결책 : 모든 컴포넌트 구성정보를 저장하는 새 컴포넌트를 추가

- 로그 분석 중앙화

  - 문제점 : 

    - 각 컴포넌트가 로그파일을 기록하는 상황에서 전체 시스템에서 발생하는 사전을 개괄하려면?
    - 문제가 발생한 컴포넌트를 찾아서 로그파일에 오류메시지를 쓰게 하려면?
    - 문제를 보고했을 때 관련된 로그 매시지를 찾으려면?
    - 근본 원인이 되는 컴포넌트를 찾으려면?

    해결책 : 로그중앙화

    - 새 컴포넌트를 감지해 로그 인벤트를 수집
    - 로그이벤트를 검색 가능한 형식의 중앙데이터베이스에 저장
    - 로그 이벤트 조회 및 분석을 위한 API, 그래픽 도구 제공

- 분산추적

  - 문제점 : 컴포넌트사이에 흐르는 요청 및 메시지를 추적할 수 있어야 한다.
  - 해결책 : 오든 요청, 로그 이벤트에 상관  ID가 있어야 한다.

- 서킷브레이커 

  - 문제점 : 동기방식으로 통신하는 컴포넌트는 연쇄장애를 일으킬수 있다.
  - 해결책 : 문제가 있는 컴포넌트를 감지해 해당 컴포넌트에 새 요청을 보내지 않도록 함

- 제어루프

  - 문제점 : 여러 서버에 분산되어있는 시스템 환경에서 중단되거나, 지연된 컴포넌트를 수동으로 감지하기 어려움.
  - 해결책 : 시스템 상태를 관찰하는 컴포넌트를 추가

- 모니터링 및 경고 중앙화

  - 문제점 : 하드웨어 사용량 문제의 근본 원인을 파악하기 어렵다
  - 해결책 : 하드웨어 자원 사용량에 대한 매트릭을 수집하는 새 컴포넌트를 시스템 환경에 추가.



